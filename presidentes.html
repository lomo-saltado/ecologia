<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidentes del Perú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .world-card {
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .president-button {
            background-color: #eef2ff;
            color: #312e81;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            border-left: 5px solid transparent;
        }
        .president-button:hover {
            background-color: #c7d2fe;
            border-left: 5px solid #4f46e5;
        }
        .president-button.active {
            background-color: #4f46e5;
            color: white;
            font-weight: 700;
        }
        .game-button {
            background-color: #10b981;
            color: white;
            font-weight: 700;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 4px solid #059669;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .game-button:hover {
            background-color: #059669;
        }
        .ai-button {
            background-color: #8b5cf6;
            border-bottom-color: #6d28d9;
        }
        .ai-button:hover {
            background-color: #7c3aed;
        }
        .back-button {
            background-color: #6b7280;
            border-bottom-color: #4b5563;
        }
        .back-button:hover {
            background-color: #4b5563;
        }
        .draggable { cursor: move; user-select: none; }
        .drop-zone { border: 2px dashed #9ca3af; min-height: 50px; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <p>Beta 1.2</p>

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-800">Explorando la Historia del Perú</h1>
            <p class="text-lg text-gray-600 mt-2">Aprende sobre los presidentes</p>
        </header>

        <!-- World Selection -->
        <div id="world-selection">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-700">Elige un Mundo para Explorar</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div id="world-1" class="card world-card p-8 text-center">
                    <h3 class="text-2xl font-bold mb-2">Mundo 1</h3>
                    <p class="text-lg">La República Aristocrática y el Oncenio (1903-1933)</p>
                </div>
                <div id="world-2" class="card world-card p-8 text-center">
                    <h3 class="text-2xl font-bold mb-2">Mundo 2</h3>
                    <p class="text-lg">Crisis, Reformas y Gobiernos Militares (1933-1980)</p>
                </div>
                <div id="world-3" class="card world-card p-8 text-center">
                    <h3 class="text-2xl font-bold mb-2">Mundo 3</h3>
                    <p class="text-lg">Retorno a la Democracia y Siglo XXI (1980-Presente)</p>
                </div>
            </div>
        </div>

        <!-- Main App View (hidden by default) -->
        <main id="main-app" class="hidden">
             <button id="back-to-worlds" class="game-button back-button mb-6 w-full md:w-auto">← Volver a los Mundos</button>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="card p-6">
                        <h2 id="world-title" class="text-2xl font-bold mb-4 text-indigo-700"></h2>
                        <div id="president-list" class="space-y-2 max-h-[60vh] overflow-y-auto pr-2"></div>
                    </div>
                </div>
                <div class="lg:col-span-2">
                    <div id="info-section" class="card p-8">
                        <h2 id="president-name" class="text-3xl font-bold text-gray-800">Selecciona un presidente</h2>
                        <div id="president-info" class="mt-4 text-gray-700 space-y-4"></div>
                    </div>
                    <div id="games-section" class="card p-8 mt-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">¡A Jugar!</h2>
                        <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
                            <button id="game1-btn" class="game-button">Adivina el Presidente ✨</button>
                            <button id="game2-btn" class="game-button">Ordena la Línea de Tiempo</button>
                            <button id="game3-btn" class="game-button">¿Quién lo Hizo? ✨</button>
                            <button id="game4-btn" class="game-button">Verdadero o Falso ✨</button>
                            <button id="game5-btn" class="game-button col-span-2 lg:col-span-3 ai-button">Examen Sorpresa con IA ✨</button>
                        </div>
                        <div id="game-container" class="mt-6"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para feedback y análisis IA -->
    <div id="feedback-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-md mx-auto">
            <h3 id="feedback-title" class="text-2xl font-bold mb-4"></h3>
            <div id="feedback-content"></div>
            <button id="close-modal-btn" class="mt-6 bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold">Cerrar</button>
        </div>
    </div>

    <script>
        const presidents = [
            // Mundo 1
            { id: 1, name: "Manuel Candamo", period: "1903-1904", fullName: "Manuel González de Candamo e Iriarte", party: "Partido Civil", economicContext: "Inicio de la República Aristocrática, economía basada en la agroexportación (azúcar, algodón) y el guano.", keyEvents: "Falleció a los 8 meses de mandato.", mainPolicies: "Promulgó la Ley de Ferrocarriles para promover la inversión privada.", endOfTerm: "Muerte por enfermedad.", legacy: "Su breve gobierno mantuvo la hegemonía del Partido Civil." },
            { id: 2, name: "Serapio Calderón", period: "1904", fullName: "Serapio Calderón Lazo de la Vega", party: "Partido Civil", economicContext: "Continuidad del modelo agroexportador.", keyEvents: "Gobierno de transición muy breve.", mainPolicies: "Su principal función fue convocar a elecciones presidenciales.", endOfTerm: "Transición democrática.", legacy: "Garantizó la sucesión constitucional tras la muerte de Candamo." },
            { id: 3, name: "José Pardo y Barreda", period: "1904-1908", fullName: "José Pardo y Barreda", party: "Partido Civil", economicContext: "Crecimiento económico por exportaciones.", keyEvents: "Gran impulso a la educación pública.", mainPolicies: "Reforma educativa: gratuidad y obligatoriedad de la educación primaria. Creación de la Escuela de Artes y Oficios.", endOfTerm: "Elecciones democráticas.", legacy: "Recordado como 'El Presidente de la Educación'." },
            { id: 4, name: "Augusto B. Leguía", period: "1908-1912", fullName: "Augusto Bernardino Leguía y Salcedo", party: "Partido Civil", economicContext: "Crisis económica por la baja de precios de exportación.", keyEvents: "Primer gobierno. Afrontó intentos de golpe de estado.", mainPolicies: "Tratados limítrofes con Brasil (Velarde-Río Branco) y Bolivia (Polo-Bustamante).", endOfTerm: "Elecciones democráticas.", legacy: "Sentó las bases para su posterior retorno y el 'Oncenio'." },
            { id: 5, name: "Guillermo Billinghurst", period: "1912-1914", fullName: "Guillermo Enrique Billinghurst Angulo", party: "Independiente (populista)", economicContext: "Tensiones sociales y económicas.", keyEvents: "Primer presidente populista, conocido como 'Pan Grande'.", mainPolicies: "Reglamentó el derecho a huelga, estableció la jornada de 8 horas para los trabajadores del muelle del Callao.", endOfTerm: "Derrocado por un golpe de estado militar liderado por Óscar R. Benavides.", legacy: "Pionero en la legislación social y laboral en el Perú." },
            { id: 6, name: "Oscar R. Benavides", period: "1914-1915", fullName: "Óscar Raymundo Benavides Larrea", party: "Militar", economicContext: "Inestabilidad por el inicio de la Primera Guerra Mundial.", keyEvents: "Gobierno provisorio tras derrocar a Billinghurst.", mainPolicies: "Restableció el orden político de la República Aristocrática.", endOfTerm: "Convocó a elecciones.", legacy: "Inició su carrera como figura clave en la política militar peruana." },
            { id: 7, name: "José Pardo y Barreda (2°)", period: "1915-1919", fullName: "José Pardo y Barreda", party: "Partido Civil", economicContext: "Boom exportador por la Primera Guerra Mundial, pero con alta inflación.", keyEvents: "Rebelión campesina de Rumi Maqui. Agitación obrera por la jornada de 8 horas.", mainPolicies: "Estableció la jornada de 8 horas a nivel nacional. Rompió relaciones con Alemania.", endOfTerm: "Derrocado por Augusto B. Leguía.", legacy: "Su segundo gobierno marcó el fin de la República Aristocrática." },
            { id: 8, name: "Augusto B. Leguía (Oncenio)", period: "1919-1930", fullName: "Augusto Bernardino Leguía y Salcedo", party: "Partido Democrático Reformista", economicContext: "Fuerte inversión extranjera (EE.UU.) y endeudamiento externo para obras públicas.", keyEvents: "Periodo conocido como el 'Oncenio'. Constitución de 1920. Celebración del Centenario de la Independencia.", mainPolicies: "Política de 'Patria Nueva'. Modernización de Lima. Ley de Conscripción Vial. Tratado de Lima con Chile (1929).", endOfTerm: "Derrocado por el Comandante Luis Miguel Sánchez Cerro tras el Crack del 29.", legacy: "Figura compleja, modernizó el país pero a costa de autoritarismo y deuda." },
            
            // Mundo 2
            { id: 9, name: "Luis Sánchez Cerro", period: "1931-1933", fullName: "Luis Miguel Sánchez Cerro", party: "Unión Revolucionaria", economicContext: "Grave crisis económica por los efectos del Crack del 29.", keyEvents: "Promulgación de la Constitución de 1933. 'Año de la Barbarie' (Revolución de Trujillo). Conflicto de Leticia con Colombia.", mainPolicies: "Fuerte represión antiaprista y anticomunista. Ley de Emergencia.", endOfTerm: "Asesinado en el Campo de Marte.", legacy: "Gobierno autoritario y populista en un periodo de extrema violencia política." },
            { id: 10, name: "Oscar R. Benavides (2°)", period: "1933-1939", fullName: "Óscar Raymundo Benavides Larrea", party: "Militar", economicContext: "Recuperación económica gradual. Creación del Seguro Social Obrero.", keyEvents: "Lema 'Orden, Paz y Trabajo'.", mainPolicies: "Política de 'paz y concordia' pero manteniendo al APRA en la ilegalidad. Finalizó la Carretera Central. Código Civil de 1936.", endOfTerm: "Elecciones democráticas.", legacy: "Pacificó el país tras la crisis, pero con un gobierno autoritario." },
            { id: 11, name: "Manuel Prado Ugarteche", period: "1939-1945", fullName: "Manuel Carlos Prado y Ugarteche", party: "Concentración Nacional", economicContext: "Impacto de la Segunda Guerra Mundial, Perú se alía con los Aliados.", keyEvents: "Guerra contra Ecuador (1941) y victoria peruana. Firma del Protocolo de Río de Janeiro (1942).", mainPolicies: "Censo de 1940. Creación de los departamentos de Tumbes y Pasco.", endOfTerm: "Elecciones democráticas.", legacy: "Lideró al país en un contexto de guerra mundial y definió las fronteras con Ecuador." },
            { id: 12, name: "José L. Bustamante y Rivero", period: "1945-1948", fullName: "José Luis Bustamante y Rivero", party: "Frente Democrático Nacional", economicContext: "Crisis económica de posguerra. Control de precios.", keyEvents: "Tesis de las 200 millas marinas para la soberanía del mar peruano.", mainPolicies: "Gobierno de amplia base democrática, pero con fuerte oposición del APRA y la oligarquía.", endOfTerm: "Derrocado por un golpe de estado de Manuel A. Odría.", legacy: "Defensor de la soberanía marítima y de la democracia." },
            { id: 13, name: "Manuel Odría (Ochenio)", period: "1948-1956", fullName: "Manuel Arturo Odría Amoretti", party: "Militar", economicContext: "Boom económico por la Guerra de Corea ('exportar o morir').", keyEvents: "Periodo conocido como el 'Ochenio'. Lema 'Hechos y no palabras'.", mainPolicies: "Ley de Seguridad Interior (represión a apristas y comunistas). Grandes obras de infraestructura: Estadio Nacional, Hospital del Empleado, Grandes Unidades Escolares. Otorgó el voto a la mujer en 1955.", endOfTerm: "Convocó a elecciones y entregó el poder.", legacy: "Dictadura modernizadora con grandes obras y represión política." },
            { id: 14, name: "Manuel Prado Ugarteche (2°)", period: "1956-1962", fullName: "Manuel Carlos Prado y Ugarteche", party: "Movimiento Democrático Peruano", economicContext: "Fin del boom exportador, inicio de crisis. Boom de la harina de pescado.", keyEvents: "Periodo de 'La Convivencia' con el APRA. Debate sobre la Reforma Agraria.", mainPolicies: "Derogó la Ley de Seguridad Interior, legalizando al APRA.", endOfTerm: "Derrocado por un golpe de estado de las Fuerzas Armadas para impedir la llegada al poder del APRA.", legacy: "Su segundo gobierno fue un intento de apertura democrática frustrado por los militares." },
            { id: 15, name: "Ricardo Pérez Godoy", period: "1962-1963", fullName: "Ricardo Pío Pérez Godoy", party: "Junta Militar de Gobierno", economicContext: "Planificación económica centralizada.", keyEvents: "Primer golpe de estado institucional de las FFAA.", mainPolicies: "Creó las bases para la Reforma Agraria. Convocó a nuevas elecciones.", endOfTerm: "Reemplazado por Nicolás Lindley.", legacy: "Inició un nuevo tipo de intervencionismo militar con fines reformistas." },
            { id: 16, name: "Nicolás Lindley", period: "1963", fullName: "Nicolás Eduardo Lindley López", party: "Junta Militar de Gobierno", economicContext: "Continuidad de la junta militar.", keyEvents: "Presidencia muy breve.", mainPolicies: "Aseguró la realización de elecciones limpias y la transferencia del poder.", endOfTerm: "Entregó el mando al presidente electo.", legacy: "Garantizó el retorno a la democracia." },
            { id: 17, name: "Fernando Belaunde Terry", period: "1963-1968", fullName: "Fernando Sergio Marcelo Marcos Belaunde Terry", party: "Acción Popular", economicContext: "Crisis económica y devaluación.", keyEvents: "Lema 'El Perú como doctrina'. Inicio de la guerrilla del MIR y ELN.", mainPolicies: "Inicio de la Reforma Agraria. Construcción de la Carretera Marginal de la Selva. Creación del Banco de la Nación.", endOfTerm: "Derrocado por el Gral. Juan Velasco Alvarado tras el 'Escándalo de la Página Once'.", legacy: "Arquitecto y visionario, su primer gobierno fue reformista pero inestable." },
            { id: 18, name: "Juan Velasco Alvarado", period: "1968-1975", fullName: "Juan Francisco Velasco Alvarado", party: "Gobierno Revolucionario de la Fuerza Armada", economicContext: "Modelo estatista y de sustitución de importaciones.", keyEvents: "Gobierno de la 'primera fase'. Lema 'Ni con Washington ni con Moscú'.", mainPolicies: "Reforma Agraria de 1969 ('Campesino, el patrón no comerá más de tu pobreza'). Nacionalización de la banca, minería y petróleo (IPC). Reforma Educativa.", endOfTerm: "Derrocado por el 'Tacnazo', un golpe interno liderado por Francisco Morales Bermúdez.", legacy: "Transformó radicalmente las estructuras sociales y económicas del Perú." },
            
            // Mundo 3
            { id: 19, name: "Francisco Morales Bermúdez", period: "1975-1980", fullName: "Francisco Morales Bermúdez Cerrutti", party: "Gobierno Revolucionario (2da Fase)", economicContext: "Grave crisis económica, inflación. 'Paquetazos' económicos.", keyEvents: "Gobierno de la 'segunda fase'. Paro nacional de 1977.", mainPolicies: "Plan Túpac Amaru para desmontar las reformas de Velasco y retornar a la democracia. Convocatoria a la Asamblea Constituyente de 1978.", endOfTerm: "Transición a la democracia.", legacy: "Lideró la transición del gobierno militar a la democracia." },
            { id: 20, name: "Fernando Belaunde Terry (2°)", period: "1980-1985", fullName: "Fernando Sergio Marcelo Marcos Belaunde Terry", party: "Acción Popular", economicContext: "Crisis de la deuda externa. Fenómeno de El Niño (1983).", keyEvents: "Inicio de la lucha armada de Sendero Luminoso y el MRTA. Devolución de los medios de comunicación a sus dueños.", mainPolicies: "Políticas liberales. Enfrentó el inicio del conflicto armado interno.", endOfTerm: "Elecciones democráticas.", legacy: "Su segundo gobierno estuvo marcado por la crisis económica y el inicio del terrorismo." },
            { id: 21, name: "Alan García", period: "1985-1990", fullName: "Alan Gabriel Ludwig García Pérez", party: "Partido Aprista Peruano", economicContext: "Hiperinflación, colapso económico. Aislamiento financiero internacional.", keyEvents: "Intento de estatización de la banca. Matanza en los penales.", mainPolicies: "Control de precios y política heterodoxa que fracasó. Limitó el pago de la deuda externa al 10% de las exportaciones.", endOfTerm: "Elecciones democráticas en medio de una crisis total.", legacy: "Su primer gobierno es recordado como uno de los más catastróficos económicamente." },
            { id: 22, name: "Alberto Fujimori", period: "1990-2000", fullName: "Alberto Ken'ya Fujimori Fujimori", party: "Cambio 90 / Perú 2000", economicContext: "Aplicación del 'Fujishock' para controlar la hiperinflación. Reinserción financiera.", keyEvents: "Autogolpe del 5 de abril de 1992. Constitución de 1993. Captura de Abimael Guzmán. Guerra del Cenepa con Ecuador (1995). Firma del Acta de Brasilia (1998).", mainPolicies: "Reformas económicas neoliberales. Lucha contra el terrorismo. Programas de asistencia social (FONCODES).", endOfTerm: "Renunció por fax desde Japón en medio de un escándalo de corrupción (vladivideos).", legacy: "Figura polarizante: exitoso contra el terrorismo y la crisis económica, pero con un gobierno autoritario y corrupto." },
            { id: 23, name: "Valentín Paniagua", period: "2000-2001", fullName: "Valentín Demetrio Paniagua Corazao", party: "Acción Popular", economicContext: "Estabilización política y económica.", keyEvents: "Gobierno de Transición.", mainPolicies: "Creación de la Comisión de la Verdad y Reconciliación (CVR) para investigar el conflicto armado interno.", endOfTerm: "Transición democrática.", legacy: "Su gobierno es valorado por restaurar la democracia y la institucionalidad." },
            { id: 24, name: "Alejandro Toledo", period: "2001-2006", fullName: "Alejandro Celestino Toledo Manrique", party: "Perú Posible", economicContext: "Crecimiento económico sostenido por altos precios de los minerales ('boom' de los commodities).", keyEvents: "Firma de Tratados de Libre Comercio (TLC) con EE.UU. y Tailandia. 'Marcha de los Cuatro Suyos'.", mainPolicies: "Programa 'Techo Propio' y 'MiVivienda'. Inicio de la Carretera Interoceánica.", endOfTerm: "Elecciones democráticas.", legacy: "Consolidó el modelo económico y el crecimiento, pero con denuncias de corrupción." },
            { id: 25, name: "Alan García (2°)", period: "2006-2011", fullName: "Alan Gabriel Ludwig García Pérez", party: "Partido Aprista Peruano", economicContext: "Continuidad del crecimiento económico. Crisis financiera global de 2008 tuvo impacto moderado.", keyEvents: "'Baguazo' (conflicto social con comunidades amazónicas).", mainPolicies: "Política de 'perro del hortelano', promoviendo la inversión privada. Implementación del TLC con EE.UU. Creación de la 'Beca 18'.", endOfTerm: "Elecciones democráticas.", legacy: "Su segundo gobierno fue económicamente exitoso y ortodoxo, en contraste con el primero." },
            { id: 26, name: "Ollanta Humala", period: "2011-2016", fullName: "Ollanta Moisés Humala Tasso", party: "Partido Nacionalista Peruano", economicContext: "Desaceleración económica por la caída de los precios de los metales.", keyEvents: "Giro hacia la moderación económica ('Hoja de Ruta'). Fallo de La Haya sobre el diferendo marítimo con Chile.", mainPolicies: "Énfasis en programas de inclusión social: 'Pensión 65', 'Qali Warma', 'Beca 18'.", endOfTerm: "Elecciones democráticas.", legacy: "Gobierno enfocado en la política social, pero con un crecimiento económico menor." },
            { id: 27, name: "Pedro Pablo Kuczynski", period: "2016-2018", fullName: "Pedro Pablo Kuczynski Godard", party: "Peruanos Por el Kambio", economicContext: "Crecimiento moderado. Ruido político constante.", keyEvents: "Enfrentamiento con el Congreso dominado por la oposición fujimorista. Indulto a Alberto Fujimori. Escándalo Odebrecht.", mainPolicies: "Impulso a la inversión en infraestructura y agua potable.", endOfTerm: "Renunció ante una inminente vacancia por incapacidad moral.", legacy: "Presidencia corta marcada por la inestabilidad política y la corrupción." },
            { id: 28, name: "Martín Vizcarra", period: "2018-2020", fullName: "Martín Alberto Vizcarra Cornejo", party: "Independiente", economicContext: "Estancamiento económico, agravado por la pandemia de COVID-19.", keyEvents: "Lucha frontal contra la corrupción ('destapes' de los Cuellos Blancos). Disolución constitucional del Congreso en 2019. Gestión de la pandemia.", mainPolicies: "Reforma política y judicial. Leyes de paridad y alternancia.", endOfTerm: "Vacado por el Congreso por 'incapacidad moral'.", legacy: "Gozó de alta popularidad por su postura anticorrupción, pero su gestión terminó abruptamente." },
            { id: 29, name: "Manuel Merino", period: "2020", fullName: "Manuel Arturo Merino de Lama", party: "Acción Popular", economicContext: "Profunda crisis económica y sanitaria.", keyEvents: "Asumió la presidencia tras la vacancia de Vizcarra, generando masivas protestas a nivel nacional.", mainPolicies: "No tuvo tiempo de implementar políticas.", endOfTerm: "Renunció a los 5 días por la presión social y la muerte de dos jóvenes (Inti y Bryan).", legacy: "Uno de los mandatos más breves y convulsos de la historia del Perú." },
            { id: 30, name: "Francisco Sagasti", period: "2020-2021", fullName: "Francisco Rafael Sagasti Hochhausler", party: "Partido Morado", economicContext: "Continuidad de la crisis por la pandemia.", keyEvents: "Gobierno de Transición y Emergencia. Bicentenario de la Independencia.", mainPolicies: "Garantizar elecciones libres y transparentes en 2021. Gestionar la compra y llegada de las primeras vacunas contra el COVID-19.", endOfTerm: "Transición democrática.", legacy: "Logró estabilizar el país en un momento de crisis extrema y asegurar la continuidad democrática." },
            { id: 31, name: "Pedro Castillo", period: "2021-2022", fullName: "José Pedro Castillo Terrones", party: "Perú Libre", economicContext: "Inestabilidad económica por la incertidumbre política. Alza de precios de combustibles y fertilizantes.", keyEvents: "Constante enfrentamiento con el Congreso. Nombramientos ministeriales cuestionados. Intentó un autogolpe de estado.", mainPolicies: "Segunda Reforma Agraria (sin éxito). Aumento del sueldo mínimo.", endOfTerm: "Destituido por el Congreso y detenido tras su intento de golpe de estado.", legacy: "Gobierno caótico y de corta duración que agudizó la crisis política." },
            { id: 32, name: "Dina Boluarte", period: "2022-Presente", fullName: "Dina Ercilia Boluarte Zegarra", party: "Independiente", economicContext: "Recesión económica en 2023. Lenta recuperación.", keyEvents: "Asumió por sucesión constitucional. Fuertes protestas sociales en su contra, con decenas de fallecidos. 'Caso Rolex'.", mainPolicies: "Gobierno enfocado en la reactivación económica y el mantenimiento del orden.", endOfTerm: "En curso.", legacy: "Primera mujer presidenta del Perú, su mandato está marcado por una profunda crisis social y de legitimidad." }
        ];

        const worlds = [
            { id: 1, title: "Mundo 1: La República Aristocrática y el Oncenio", president_ids: [1, 2, 3, 4, 5, 6, 7, 8] },
            { id: 2, title: "Mundo 2: Crisis, Reformas y Gobiernos Militares", president_ids: [9, 10, 11, 12, 13, 14, 15, 16, 17, 18] },
            { id: 3, title: "Mundo 3: Retorno a la Democracia y Siglo XXI", president_ids: [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32] }
        ];
        
        let currentWorldPresidents = [];

        const worldSelectionView = document.getElementById('world-selection');
        const mainAppView = document.getElementById('main-app');
        const presidentList = document.getElementById('president-list');
        const presidentName = document.getElementById('president-name');
        const presidentInfo = document.getElementById('president-info');
        const worldTitle = document.getElementById('world-title');
        const gameContainer = document.getElementById('game-container');
        const feedbackModal = document.getElementById('feedback-modal');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackContent = document.getElementById('feedback-content');
        const closeModalBtn = document.getElementById('close-modal-btn');

        // --- Gemini API Helper ---
        const callGeminiAPI = async (prompt) => {
            const apiKey = "AIzaSyDJnxdmaG66UQjjMa4bB_ZoV6etCeQse8s"; // Será reemplazado por el entorno de ejecución
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }]
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Error en la API: ${response.statusText}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    return text;
                } else {
                    throw new Error("Respuesta no válida de la API.");
                }
            } catch (error) {
                console.error("Error al llamar a la API de Gemini:", error);
                return null;
            }
        };


        function showWorlds() {
            worldSelectionView.style.display = 'block';
            mainAppView.style.display = 'none';
        }

        function showWorld(worldId) {
            const world = worlds.find(w => w.id === worldId);
            if (!world) return;
            
            currentWorldPresidents = presidents.filter(p => world.president_ids.includes(p.id));
            worldTitle.textContent = world.title;
            
            presidentList.innerHTML = '';
            currentWorldPresidents.forEach(p => {
                const button = document.createElement('div');
                button.classList.add('president-button');
                button.textContent = p.name;
                button.dataset.id = p.id;
                // FIX: Use onclick for consistent event handling
                button.onclick = () => showPresidentInfo(p.id);
                presidentList.appendChild(button);
            });

            presidentName.textContent = 'Selecciona un presidente';
            presidentInfo.innerHTML = '<p>Haz clic en un nombre de la lista para ver su información detallada.</p>';
            gameContainer.innerHTML = '';

            worldSelectionView.style.display = 'none';
            mainAppView.style.display = 'block';
        }

        function showPresidentInfo(id) {
            const president = presidents.find(p => p.id === id);
            if (president) {
                presidentName.textContent = president.fullName;
                presidentInfo.innerHTML = `
                    <div class="space-y-3 text-base">
                        <p><strong><span class="text-indigo-600">Nombre Completo:</span></strong> ${president.fullName}</p>
                        <p><strong><span class="text-indigo-600">Periodo:</span></strong> ${president.period}</p>
                        <p><strong><span class="text-indigo-600">Partido Político:</span></strong> ${president.party}</p>
                        <p><strong><span class="text-indigo-600">Contexto Económico:</span></strong> ${president.economicContext}</p>
                        <p><strong><span class="text-indigo-600">Eventos Clave:</span></strong> ${president.keyEvents}</p>
                        <p><strong><span class="text-indigo-600">Políticas Principales:</span></strong> ${president.mainPolicies}</p>
                        <p><strong><span class="text-indigo-600">Fin del Mandato:</span></strong> ${president.endOfTerm}</p>
                        <p><strong><span class="text-indigo-600">Legado:</span></strong> ${president.legacy}</p>
                    </div>
                    <button id="ai-analysis-btn" class="game-button ai-button w-full mt-6">✨ Analizar Legado con IA</button>
                `;
                document.querySelectorAll('.president-button').forEach(btn => {
                    btn.classList.toggle('active', parseInt(btn.dataset.id) === id);
                });

                document.getElementById('ai-analysis-btn').addEventListener('click', () => getLegacyAnalysis(president));
            }
        }

        async function getLegacyAnalysis(president) {
            feedbackTitle.textContent = `Análisis sobre ${president.name}`;
            feedbackContent.innerHTML = '<div class="loader"></div>';
            feedbackModal.style.display = 'flex';

            const prompt = `Analiza el legado del presidente peruano ${president.fullName} en un párrafo conciso y fácil de entender para un estudiante. Considera sus políticas principales, el contexto económico y los eventos clave de su mandato. Su información es: ${JSON.stringify(president)}. Enfócate en su impacto a largo plazo en el Perú.`;
            
            const analysis = await callGeminiAPI(prompt);

            if(analysis) {
                feedbackContent.innerHTML = `<p class="text-left">${analysis.replace(/\n/g, '<br>')}</p>`;
            } else {
                feedbackContent.innerHTML = `<p class="text-red-500">No se pudo generar el análisis. Inténtalo de nuevo.</p>`;
            }
        }

        // Event Listeners
        document.getElementById('world-1').addEventListener('click', () => showWorld(1));
        document.getElementById('world-2').addEventListener('click', () => showWorld(2));
        document.getElementById('world-3').addEventListener('click', () => showWorld(3));
        document.getElementById('back-to-worlds').addEventListener('click', showWorlds);
        
        closeModalBtn.addEventListener('click', () => feedbackModal.style.display = 'none');

        function showFeedback(title, content, isCorrect) {
            feedbackTitle.textContent = title;
            feedbackTitle.style.color = isCorrect ? '#16a34a' : '#dc2626';
            feedbackContent.innerHTML = `<p>${content}</p>`;
            feedbackModal.style.display = 'flex';
        }

        // FIX: Enhanced endGame function to restore president button event listeners
        function endGame() {
            gameContainer.innerHTML = '';
            // Restore original functionality to president buttons
            document.querySelectorAll('#president-list .president-button').forEach(btn => {
                const presidentId = parseInt(btn.dataset.id);
                // Re-assign the original click handler
                btn.onclick = () => showPresidentInfo(presidentId);
            });
        }

        // --- Games ---
        document.getElementById('game1-btn').addEventListener('click', () => startGame1(currentWorldPresidents));
        document.getElementById('game2-btn').addEventListener('click', () => startGame2(currentWorldPresidents));
        document.getElementById('game3-btn').addEventListener('click', () => startGame3(currentWorldPresidents));
        document.getElementById('game4-btn').addEventListener('click', () => startGame4(currentWorldPresidents));
        document.getElementById('game5-btn').addEventListener('click', () => startGame5(currentWorldPresidents));

        async function startGame1(gamePresidents) {
            gameContainer.innerHTML = `
                <h3 class="text-2xl font-bold text-indigo-700 mb-4">Adivina el Presidente ✨</h3>
                <div id="game-loader" class="text-center"><div class="loader"></div><p class="text-gray-600">Generando pista con IA...</p></div>
                <div id="game-content" class="hidden">
                    <p class="text-lg mb-4 bg-indigo-100 p-4 rounded-lg" id="game-question"></p>
                    <p class="text-gray-600 font-semibold mb-2">Haz clic en el presidente correcto de la lista.</p>
                    <button onclick="endGame()" class="game-button back-button w-full mt-4">Finalizar Juego</button>
                </div>`;
            
            const randomPresident = gamePresidents[Math.floor(Math.random() * gamePresidents.length)];
            const prompt = `Genera una pista creativa y educativa sobre el presidente del Perú ${randomPresident.name}, sin mencionar su nombre. La pista debe ser fácil de entender para un estudiante. Ejemplo: 'Durante mi gobierno se construyó el Estadio Nacional'.`;
            
            const clue = await callGeminiAPI(prompt);

            document.getElementById('game-loader').style.display = 'none';
            document.getElementById('game-content').style.display = 'block';

            if (clue) {
                document.getElementById('game-question').textContent = clue;
                document.querySelectorAll('.president-button').forEach(btn => {
                    btn.onclick = () => {
                        if (parseInt(btn.dataset.id) === randomPresident.id) {
                            showFeedback('¡Correcto!', '¡Muy bien!', true);
                            startGame1(gamePresidents);
                        } else {
                            showFeedback('Incorrecto', `La respuesta era ${randomPresident.name}.`, false);
                        }
                    };
                });
            } else {
                 document.getElementById('game-question').textContent = 'Error al generar la pista. Inténtalo de nuevo.';
            }
        }

        function startGame2(gamePresidents) {
            gameContainer.innerHTML = `
                <h3 class="text-2xl font-bold text-indigo-700 mb-4">Ordena la Línea de Tiempo</h3>
                <p class="text-gray-600 mb-4">Arrastra y suelta a los presidentes en el orden cronológico correcto.</p>
                <div id="timeline-options" class="flex flex-wrap gap-2 mb-4 p-4 bg-gray-100 rounded-lg min-h-[50px]"></div>
                <div id="timeline-dropzone" class="space-y-2 p-4 rounded-lg drop-zone"></div>
                <div class="flex flex-col gap-2 mt-4">
                    <button id="check-timeline-btn" class="game-button w-full">Verificar Orden</button>
                    <button onclick="endGame()" class="game-button back-button w-full">Finalizar Juego</button>
                </div>`;

            const optionsContainer = document.getElementById('timeline-options');
            const dropZone = document.getElementById('timeline-dropzone');
            const selectedPresidents = [...gamePresidents].sort(() => 0.5 - Math.random()).slice(0, 5);

            selectedPresidents.forEach(p => {
                const div = document.createElement('div');
                div.id = `drag-${p.id}`;
                div.dataset.id = p.id;
                div.textContent = p.name;
                div.classList.add('p-2', 'bg-amber-200', 'rounded-md', 'draggable', 'text-center');
                div.draggable = true;
                optionsContainer.appendChild(div);
                div.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', e.target.id);
                    setTimeout(() => e.target.classList.add('hidden'), 0);
                });
            });

            [dropZone, optionsContainer].forEach(container => {
                container.addEventListener('dragover', e => e.preventDefault());
                container.addEventListener('drop', e => {
                    e.preventDefault();
                    const id = e.dataTransfer.getData('text');
                    const draggableElement = document.getElementById(id);
                    if (draggableElement) {
                       draggableElement.classList.remove('hidden');
                       container.appendChild(draggableElement);
                    }
                });
            });

            document.getElementById('check-timeline-btn').addEventListener('click', () => {
                const droppedElements = dropZone.querySelectorAll('.draggable');
                const droppedIds = Array.from(droppedElements).map(el => parseInt(el.dataset.id));
                const correctOrder = selectedPresidents.sort((a, b) => parseInt(a.period.split('-')[0]) - parseInt(b.period.split('-')[0])).map(p => p.id);
                
                const isCorrect = droppedIds.length === correctOrder.length && droppedIds.every((id, index) => id === correctOrder[index]);

                if (isCorrect) {
                    showFeedback('¡Excelente!', 'El orden es correcto.', true);
                } else {
                    showFeedback('Incorrecto', 'El orden no es correcto. ¡Inténtalo de nuevo!', false);
                }
            });
        }

        async function startGame3(gamePresidents) {
            gameContainer.innerHTML = `
                <h3 class="text-2xl font-bold text-indigo-700 mb-4">¿Quién lo Hizo? ✨</h3>
                <div id="game-loader" class="text-center"><div class="loader"></div><p class="text-gray-600">Generando pregunta con IA...</p></div>
                <div id="game-content" class="hidden">
                    <p class="text-lg mb-4 bg-indigo-100 p-4 rounded-lg" id="game3-question"></p>
                    <div id="game3-options" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                    <button onclick="endGame()" class="game-button back-button w-full mt-4">Finalizar Juego</button>
                </div>`;

            const correctPresident = gamePresidents[Math.floor(Math.random() * gamePresidents.length)];
            const otherPresidents = gamePresidents.filter(p => p.id !== correctPresident.id).map(p => p.name).join(', ');
            
            const prompt = `Crea una pregunta de opción múltiple para un juego. La pregunta debe ser sobre una política o evento clave del presidente peruano ${correctPresident.name}. Proporciona 3 opciones incorrectas (distractores) de la siguiente lista de presidentes contemporáneos: ${otherPresidents}. Responde únicamente con un objeto JSON con las claves "question" (string), y "options" (un array de 4 strings, uno de ellos es ${correctPresident.name}).`;

            const responseText = await callGeminiAPI(prompt);
            
            document.getElementById('game-loader').style.display = 'none';
            document.getElementById('game-content').style.display = 'block';

            if (responseText) {
                try {
                    // Limpiar el texto para que sea un JSON válido
                    const cleanedJson = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const data = JSON.parse(cleanedJson);
                    
                    document.getElementById('game3-question').textContent = data.question;
                    const optionsEl = document.getElementById('game3-options');
                    optionsEl.innerHTML = '';

                    // Mezclar las opciones
                    data.options.sort(() => Math.random() - 0.5).forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option;
                        button.classList.add('p-4', 'rounded-lg', 'text-left', 'font-semibold', 'bg-white', 'shadow', 'hover:bg-gray-100', 'transition');
                        button.onclick = () => {
                            if (option === correctPresident.name) {
                                showFeedback('¡Correcto!', '', true);
                                startGame3(gamePresidents);
                            } else {
                                showFeedback('Incorrecto', `La respuesta correcta era ${correctPresident.name}.`, false);
                            }
                        };
                        optionsEl.appendChild(button);
                    });
                } catch (e) {
                    console.error("Error al parsear JSON de la IA:", e, responseText);
                    gameContainer.innerHTML += '<p class="text-red-500">Error al procesar la pregunta de la IA.</p>';
                }
            } else {
                gameContainer.innerHTML += '<p class="text-red-500">No se pudo generar la pregunta. Inténtalo de nuevo.</p>';
            }
        }

        async function startGame4(gamePresidents) {
            gameContainer.innerHTML = `
                <h3 class="text-2xl font-bold text-indigo-700 mb-4">Verdadero o Falso ✨</h3>
                 <div id="game-loader" class="text-center"><div class="loader"></div><p class="text-gray-600">Generando afirmación con IA...</p></div>
                <div id="game-content" class="hidden">
                    <p class="text-lg mb-4 bg-indigo-100 p-4 rounded-lg" id="game4-statement"></p>
                    <div class="flex gap-4">
                        <button id="true-btn" class="game-button w-full">Verdadero</button>
                        <button id="false-btn" class="game-button w-full bg-red-500 border-b-red-700 hover:bg-red-700">Falso</button>
                    </div>
                    <button onclick="endGame()" class="game-button back-button w-full mt-4">Finalizar Juego</button>
                </div>`;
            
            const prompt = `Crea una afirmación para un juego de verdadero o falso sobre un presidente peruano. Elige aleatoriamente un presidente de esta lista: ${gamePresidents.map(p => p.name).join(', ')}. Decide aleatoriamente si la afirmación será verdadera o falsa. Si es falsa, debe ser plausible pero incorrecta. Responde únicamente con un objeto JSON con las claves "statement" (string) y "isTrue" (boolean).`;
            
            const responseText = await callGeminiAPI(prompt);
            
            document.getElementById('game-loader').style.display = 'none';
            document.getElementById('game-content').style.display = 'block';

            if (responseText) {
                try {
                    const cleanedJson = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const data = JSON.parse(cleanedJson);

                    document.getElementById('game4-statement').textContent = data.statement;

                    document.getElementById('true-btn').onclick = () => {
                        if (data.isTrue) showFeedback('¡Correcto!', '', true);
                        else showFeedback('Incorrecto', '', false);
                        startGame4(gamePresidents);
                    };
                    document.getElementById('false-btn').onclick = () => {
                        if (!data.isTrue) showFeedback('¡Correcto!', '', true);
                        else showFeedback('Incorrecto', '', false);
                        startGame4(gamePresidents);
                    };
                } catch (e) {
                     console.error("Error al parsear JSON de la IA:", e, responseText);
                    gameContainer.innerHTML += '<p class="text-red-500">Error al procesar la afirmación de la IA.</p>';
                }
            } else {
                 gameContainer.innerHTML += '<p class="text-red-500">No se pudo generar la afirmación. Inténtalo de nuevo.</p>';
            }
        }
        
        async function startGame5(gamePresidents) {
            gameContainer.innerHTML = `
                <h3 class="text-2xl font-bold text-indigo-700 mb-4">Examen Sorpresa con IA ✨</h3>
                <div id="game-loader" class="text-center"><div class="loader"></div><p class="text-gray-600">La IA está preparando tu examen...</p></div>
                <div id="game-content" class="hidden"></div>`;

            const presidentNames = gamePresidents.map(p => p.name).join(', ');
            const prompt = `Eres un profesor de historia del Perú. Crea un examen de 3 preguntas de opción múltiple sobre los siguientes presidentes: ${presidentNames}. Las preguntas deben ser desafiantes pero justas para un estudiante. Responde únicamente con un objeto JSON que contenga un array llamado "quiz". Cada objeto en el array debe tener las claves "question" (string), "options" (un array de 4 strings), y "answer" (el string de la respuesta correcta).`;

            const responseText = await callGeminiAPI(prompt);
            document.getElementById('game-loader').style.display = 'none';
            const gameContent = document.getElementById('game-content');
            gameContent.style.display = 'block';

            if (responseText) {
                try {
                    const cleanedJson = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const data = JSON.parse(cleanedJson);
                    
                    let quizHtml = '<div id="quiz-form" class="space-y-6">';
                    data.quiz.forEach((item, index) => {
                        quizHtml += `
                            <div class="bg-white p-4 rounded-lg shadow">
                                <p class="font-semibold mb-2">${index + 1}. ${item.question}</p>
                                <div class="space-y-2">
                                    ${item.options.map(option => `
                                        <div>
                                            <input type="radio" id="q${index}o${option}" name="q${index}" value="${option}" class="mr-2">
                                            <label for="q${index}o${option}">${option}</label>
                                        </div>
                                    `).join('')}
                                </div>
                                <input type="hidden" id="answer${index}" value="${item.answer}">
                            </div>
                        `;
                    });
                    quizHtml += `</div>
                    <div class="flex flex-col gap-2 mt-6">
                        <button id="submit-quiz" class="game-button w-full">Calificar Examen</button>
                        <button onclick="endGame()" class="game-button back-button w-full">Finalizar Juego</button>
                    </div>`;
                    gameContent.innerHTML = quizHtml;

                    document.getElementById('submit-quiz').addEventListener('click', () => {
                        let score = 0;
                        data.quiz.forEach((item, index) => {
                            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                            if (selectedOption && selectedOption.value === item.answer) {
                                score++;
                            }
                        });
                        showFeedback('Examen Calificado', `Obtuviste ${score} de ${data.quiz.length} respuestas correctas.`, true);
                    });

                } catch (e) {
                    console.error("Error al parsear JSON de la IA:", e, responseText);
                    gameContent.innerHTML = '<p class="text-red-500">Error al procesar el examen de la IA.</p>';
                }
            } else {
                gameContent.innerHTML = '<p class="text-red-500">No se pudo generar el examen. Inténtalo de nuevo.</p>';
            }
        }

        // Initial state
        showWorlds();
    </script>
</body>
</html>
